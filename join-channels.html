<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Channels & Servers - Emoji Paradise</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="theme.js"></script>
    <script src="auth.js"></script>
    <script>
    // Override auth functions immediately after auth.js loads for join-channels page
    (function() {
        // Wait for auth.js to be ready
        function initJoinChannelsAuth() {
            console.log('Initializing join-channels auth overrides...');
            
            // Override showAuthModal
            window.showAuthModal = function(type) {
                console.log('Join-channels showAuthModal called with:', type);
                var modal = document.getElementById('auth-modal');
                if (!modal) {
                    console.error('Modal not found!');
                    return;
                }
                
                console.log('Modal found, current classes:', modal.className);
                console.log('Modal current display:', getComputedStyle(modal).display);
                
                // Remove any inline styles that might conflict and add active class
                modal.style.display = '';
                modal.classList.add('active');
                
                console.log('Added active class, new classes:', modal.className);
                console.log('New display style:', getComputedStyle(modal).display);
                console.log('Visibility:', getComputedStyle(modal).visibility);
                console.log('Opacity:', getComputedStyle(modal).opacity);
                
                var loginForm = document.getElementById('login-form');
                var signupForm = document.getElementById('signup-form');
                
                console.log('Forms found - Login:', !!loginForm, 'Signup:', !!signupForm);
                
                if (loginForm && signupForm) {
                    // Hide all forms first and remove active classes
                    loginForm.style.display = 'none';
                    loginForm.classList.remove('active');
                    signupForm.style.display = 'none';
                    signupForm.classList.remove('active');
                    
                    // Show the correct form with both display and active class
                    if (type === 'login') {
                        loginForm.style.display = 'block';
                        loginForm.classList.add('active');
                        console.log('Showing login form with active class');
                    } else if (type === 'signup') {
                        signupForm.style.display = 'block';
                        signupForm.classList.add('active');
                        console.log('Showing signup form with active class');
                    }
                }
                
                // Update nav button states
                var loginBtn = document.getElementById('nav-login-btn');
                var signupBtn = document.getElementById('nav-signup-btn');
                if (loginBtn && signupBtn) {
                    loginBtn.classList.remove('active');
                    signupBtn.classList.remove('active');
                    if (type === 'signup') {
                        signupBtn.classList.add('active');
                    } else {
                        loginBtn.classList.add('active');
                    }
                    console.log('Updated nav button states');
                }
                
                // Focus first input
                setTimeout(function() {
                    var input = (type === 'login') ? document.getElementById('login-username') : document.getElementById('signup-username');
                    if (input) {
                        input.focus();
                        console.log('Focused input:', input.id);
                    }
                }, 100);
                
                console.log('Modal should now be visible with active class:', modal.classList.contains('active'));
            };
            
            // Override closeAuthModal
            window.closeAuthModal = function() {
                console.log('Join-channels closeAuthModal called');
                var modal = document.getElementById('auth-modal');
                if (modal) {
                    modal.classList.remove('active');
                    
                    // Also reset form states
                    var loginForm = document.getElementById('login-form');
                    var signupForm = document.getElementById('signup-form');
                    if (loginForm) {
                        loginForm.style.display = 'none';
                        loginForm.classList.remove('active');
                    }
                    if (signupForm) {
                        signupForm.style.display = 'none';
                        signupForm.classList.remove('active');
                    }
                    
                    // Reset nav button states
                    var loginBtn = document.getElementById('nav-login-btn');
                    var signupBtn = document.getElementById('nav-signup-btn');
                    if (loginBtn && signupBtn) {
                        loginBtn.classList.remove('active');
                        signupBtn.classList.remove('active');
                    }
                }
            };
            
            // Add form handlers
            window.handleLogin = function(e) { 
                e.preventDefault(); 
                closeAuthModal(); 
                alert('Login submitted!'); 
            };
            
            window.handleSignup = function(e) { 
                e.preventDefault(); 
                closeAuthModal(); 
                alert('Signup submitted!'); 
            };
            
            // Close modal only when clicking outside modal-content
            document.addEventListener('mousedown', function(e) {
                var modal = document.getElementById('auth-modal');
                if (!modal || !modal.classList.contains('active')) return;
                var modalContent = modal.querySelector('.modal-content');
                if (e.target === modal && !modalContent.contains(e.target)) closeAuthModal();
                // If click is directly on modal (background), close
                if (e.target === modal) closeAuthModal();
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeAuthModal();
            });
            
            console.log('Join-channels auth overrides ready!');
        }
        
        // Initialize immediately or wait for DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initJoinChannelsAuth);
        } else {
            initJoinChannelsAuth();
        }
    })();
    </script>
</head>
    <body>
        <header>
        <!-- Login/Signup Modal (copied from index.html, minimal) -->
        <div id="auth-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title">
            <div class="modal-content auth-container animated-modal" tabindex="-1">
                <div class="auth-close" onclick="closeAuthModal()" aria-label="Close authentication modal">
                    <span></span>
                    <span></span>
                </div>
                <div class="auth-illustration auth-illustration-center">
                    <span class="emoji" id="auth-emoji inline">🔒</span>
                </div>
                <div class="auth-modal-logo auth-modal-logo-flex">
                    <h1 id="auth-modal-title" class="auth-modal-logo-title">Emoji Paradise</h1>
                    <span>Authentication Modal</span>
                </div>
                <div class="auth-content">
                    <form id="login-form" class="auth-form animated-form" onsubmit="handleLogin(event)">
                        <div class="form-header form-header-center">
                            <h2 class="form-header-title-mb">Welcome Back!</h2>
                            <p class="subtitle form-header-subtitle-mb">Login to continue to your account</p>
                        </div>
                        <div class="form-group form-group-mb">
                            <div class="input-group">
                                <input type="text" id="login-username" required autocomplete="username" placeholder=" " aria-label="Username">
                                <label for="login-username">Username</label>
                                <span class="input-icon"><i class="fas fa-user"></i></span>
                                <div class="input-underline"></div>
                            </div>
                        </div>
                        <div class="form-group form-group-mb">
                            <div class="input-group">
                                <input type="password" id="login-password" required autocomplete="current-password" placeholder=" " aria-label="Password">
                                <label for="login-password">Password</label>
                                <span class="input-icon"><i class="fas fa-lock"></i></span>
                                <div class="input-underline"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block btn-animate btn-block-mb">
                            <span class="btn-text">Login</span>
                        </button>
                    </form>
                    <form id="signup-form" class="auth-form animated-form" onsubmit="handleSignup(event)">
                        <div class="form-header form-header-center">
                            <h2 class="form-header-title-mb">Create Account</h2>
                            <p class="subtitle form-header-subtitle-mb">Join our emoji paradise community</p>
                        </div>
                        <div class="form-group form-group-mb">
                            <div class="input-group">
                                <input type="text" id="signup-username" required autocomplete="username" placeholder=" " aria-label="Username">
                                <label for="signup-username">Username</label>
                                <span class="input-icon"><i class="fas fa-user"></i></span>
                                <div class="input-underline"></div>
                            </div>
                        </div>
                        <div class="form-group form-group-mb">
                            <div class="input-group">
                                <input type="email" id="signup-email" required placeholder=" " aria-label="Email">
                                <label for="signup-email">Email</label>
                                <span class="input-icon"><i class="fas fa-envelope"></i></span>
                                <div class="input-underline"></div>
                            </div>
                        </div>
                        <div class="form-group form-group-mb-small">
                            <div class="input-group">
                                <input type="password" id="signup-password" required autocomplete="new-password" placeholder=" " aria-label="Password">
                                <label for="signup-password">Password</label>
                                <span class="input-icon"><i class="fas fa-lock"></i></span>
                                <div class="input-underline"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block btn-animate btn-block-mb">
                            <span class="btn-text">Sign Up</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
            <nav class="navbar">
                <div class="nav-container">
                    <div class="logo" style="flex: 0 0 auto; display: flex; align-items: center; justify-content: flex-start; min-width: 0;">
                        <h1 style="font-size: 1.7rem; margin: 0; white-space: nowrap; overflow: visible; text-overflow: unset; max-width: none; text-align: left;">
                            <a href="index.html" style="color: inherit; text-decoration: none;">🎨 Emoji Paradise</a>
                        </h1>
                    </div>
                    <div class="hamburger" onclick="toggleMenu()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <ul class="nav-menu">
                        <li><a href="index.html#emojis" class="nav-link">Emojis</a></li>
                        <li><a href="index.html#gifs" class="nav-link">GIFs</a></li>
                        <li><a href="index.html#customize" class="nav-link">Customize</a></li>
                        <li><a href="index.html#downloads" class="nav-link">Downloads</a></li>
                        <li><a href="join-channels.html" class="nav-link join-btn active" id="join-channels-btn" style="display:none;">Join Channels/Servers</a></li>
                        <li class="nav-item auth-container">
                            <div class="auth-toggle">
                                <button type="button" class="auth-btn" data-tab="login" id="nav-login-btn" onclick="showAuthModal('login')">Login</button>
                                <button type="button" class="auth-btn" data-tab="signup" id="nav-signup-btn" onclick="showAuthModal('signup')">Sign Up</button>
                                <span class="auth-slider"></span>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a href="index.html" class="nav-link back-to-main">
                                <i class="fas fa-arrow-left"></i> Back to Main
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <script>
        // Add theme toggle button to nav if not present (for consistency with index.html)
        document.addEventListener('DOMContentLoaded', function() {
            if (!document.querySelector('.theme-toggle')) {
                if (typeof initTheme === 'function') initTheme();
            }
            
            // Initialize auth system if available
            if (typeof initAuth === 'function') {
                initAuth().catch(function(error) {
                    console.log('Auth initialization failed, using fallback:', error);
                });
            }
            
            // Test the auth modal functions and structure
            console.log('Testing auth functions...');
            console.log('showAuthModal available:', typeof window.showAuthModal);
            console.log('closeAuthModal available:', typeof window.closeAuthModal);
            
            // Check modal structure
            const modal = document.getElementById('auth-modal');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            console.log('Modal found:', !!modal);
            console.log('Login form found:', !!loginForm);
            console.log('Signup form found:', !!signupForm);
            
            // Ensure forms are initially hidden
            if (loginForm) {
                loginForm.style.display = 'none';
                console.log('Login form hidden initially');
            }
            if (signupForm) {
                signupForm.style.display = 'none';
                console.log('Signup form hidden initially');
            }
        });
        </script>

    <main>
    <div class="join-channels-container">
        <div class="join-header animate-fade-in-up" data-animate>
            <h1>🚀 Join Channels & Servers</h1>
            <p>Connect with amazing communities and discover new content!</p>
        </div>

        <!-- Search Bar -->
        <div class="search-bar-container animate-fade-in-up" data-animate style="max-width:480px;margin:0 auto 1.2rem auto;">
            <input type="text" id="channel-search" class="custom-join-input" placeholder="Search channels or servers by name, description, or tags..." oninput="filterChannels()" style="width:100%;font-size:1.08rem;">
        </div>

        <!-- Platform Selection Tabs -->
        <div class="platform-tabs animate-fade-in-up" data-animate>
            <button class="platform-tab active" onclick="showPlatform('telegram')">
                <i class="fab fa-telegram"></i>
                Telegram
            </button>
            <button class="platform-tab" onclick="showPlatform('discord')">
                <i class="fab fa-discord"></i>
                Discord
            </button>
            <button class="platform-tab" onclick="showPlatform('whatsapp')">
                <i class="fab fa-whatsapp"></i>
                WhatsApp
            </button>
        </div>

        <!-- Status Message -->
        <div id="status-message" class="status-message"></div>

        <!-- Confetti Canvas -->
        <canvas id="confetti-canvas" style="position:fixed;pointer-events:none;top:0;left:0;width:100vw;height:100vh;z-index:9999;display:none;"></canvas>

        <!-- Telegram Channels -->
        <div id="telegram-content" class="platform-content active">
            <h2>📱 Telegram Channels</h2>
            <div class="channel-grid" id="telegram-channels">
                <!-- Telegram channels will be loaded here -->
            </div>
        </div>

        <!-- Discord Servers -->
        <div id="discord-content" class="platform-content">
            <h2>🎮 Discord Servers</h2>
            <div class="channel-grid" id="discord-servers">
                <!-- Discord servers will be loaded here -->
            </div>
        </div>

        <!-- WhatsApp Groups -->
        <div id="whatsapp-content" class="platform-content">
            <h2>💚 WhatsApp Groups</h2>
            <div class="channel-grid" id="whatsapp-groups">
                <!-- WhatsApp groups will be loaded here -->
            </div>
        </div>

        <!-- Custom Join Section -->
        <div class="custom-join-section animate-fade-in-up" data-animate>
            <h3>Add Your Group</h3>
            <p>Add your server and channel links here.</p>
            <form class="custom-join-form" onsubmit="joinCustomChannel(event)">
                <input type="text" id="custom-name" class="custom-join-input" placeholder="Channel/Server Name" maxlength="64" required>
                <input type="text" id="custom-description" class="custom-join-input" placeholder="Description (optional)" maxlength="120">
                <input type="text" id="custom-tags" class="custom-join-input" placeholder="Tags (comma separated, e.g. fun, memes)" maxlength="60">
                <input type="url" id="custom-link" class="custom-join-input" placeholder="Paste channel/server invite link here..." required>
                <button type="submit" class="join-btn custom-join-btn">
                    <i class="fas fa-plus"></i> Join
                </button>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentPlatform = 'telegram';
        let joinedChannels = new Set();

        // Platform data
        const platformData = {
            telegram: [
                {
                    id: 'emoji_paradise',
                    name: 'Emoji Paradise Official',
                    description: 'Get the latest emoji packs, stickers, and updates from our community!',
                    members: '15.2K',
                    tags: ['Official', 'Emojis', 'Updates'],
                    link: 'https://t.me/emoji_paradise_official',
                    icon: '🎨'
                },
                {
                    id: 'gif_central',
                    name: 'GIF Central Hub',
                    description: 'Amazing collection of GIFs, animations, and video content for everyone.',
                    members: '8.5K',
                    tags: ['GIFs', 'Animations', 'Fun'],
                    link: 'https://t.me/gif_central_hub',
                    icon: '🎬'
                },
                {
                    id: 'sticker_world',
                    name: 'Sticker World',
                    description: 'Premium sticker packs and custom emoji collections from artists worldwide.',
                    members: '12.8K',
                    tags: ['Stickers', 'Art', 'Premium'],
                    link: 'https://t.me/sticker_world_premium',
                    icon: '🌟'
                }
            ],
            discord: [
                {
                    id: 'emoji_paradise_discord',
                    name: 'Emoji Paradise Community',
                    description: 'Chat with fellow emoji enthusiasts, share creations, and get support!',
                    members: '5.2K',
                    tags: ['Community', 'Chat', 'Support'],
                    link: 'https://discord.gg/emoji-paradise',
                    icon: '🎨'
                },
                {
                    id: 'creative_minds',
                    name: 'Creative Minds',
                    description: 'A place for digital artists, designers, and creators to collaborate.',
                    members: '3.8K',
                    tags: ['Art', 'Design', 'Collaboration'],
                    link: 'https://discord.gg/creative-minds',
                    icon: '🎭'
                }
            ],
            whatsapp: [
                {
                    id: 'emoji_lovers',
                    name: 'Emoji Lovers',
                    description: 'Share your favorite emojis and discover new ones with like-minded people.',
                    members: '256',
                    tags: ['Emojis', 'Sharing', 'Community'],
                    link: 'https://chat.whatsapp.com/emoji-lovers',
                    icon: '😍'
                },
                {
                    id: 'gif_enthusiasts',
                    name: 'GIF Enthusiasts',
                    description: 'The best place to share and discover amazing GIFs and animations.',
                    members: '189',
                    tags: ['GIFs', 'Fun', 'Entertainment'],
                    link: 'https://chat.whatsapp.com/gif-enthusiasts',
                    icon: '🎉'
                }
            ]
        };

        // Filter and search logic
        let lastSearchQuery = '';
        function filterChannels() {
            const query = document.getElementById('channel-search').value.trim().toLowerCase();
            lastSearchQuery = query;
            loadChannels(currentPlatform, query);
        }

        function loadChannels(platform, searchQuery = '') {
            const container = document.getElementById(`${platform}-${platform === 'discord' ? 'servers' : platform === 'whatsapp' ? 'groups' : 'channels'}`);
            let channels = platformData[platform] || [];
            if (searchQuery) {
                channels = channels.filter(channel => {
                    const name = (channel.name || '').toLowerCase();
                    const desc = (channel.description || '').toLowerCase();
                    const tags = (channel.tags || []).join(' ').toLowerCase();
                    return name.includes(searchQuery) || desc.includes(searchQuery) || tags.includes(searchQuery);
                });
            }
            container.innerHTML = channels.length > 0
                ? channels.map(channel => createChannelCard(channel)).join('')
                : `<div style="text-align:center;color:var(--text-secondary,#888);padding:2rem 0;">No channels or servers found.</div>`;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadChannels('telegram');
            loadJoinedChannels();
            loadFooterStats(); // Load footer statistics
            // Enhance scroll animations on load
            if (window.Animations && typeof window.Animations.initScrollAnimations === 'function') {
                window.Animations.initScrollAnimations();
            }
            // If search bar exists, restore last query
            const searchInput = document.getElementById('channel-search');
            if (searchInput && lastSearchQuery) {
                searchInput.value = lastSearchQuery;
                filterChannels();
            }
        });

        // Show platform content
        function showPlatform(platform) {
            // Update tabs
            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[onclick="showPlatform('${platform}')"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.platform-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${platform}-content`).classList.add('active');

            currentPlatform = platform;
            // Use last search query if present
            const searchInput = document.getElementById('channel-search');
            const query = searchInput ? searchInput.value.trim().toLowerCase() : '';
            loadChannels(platform, query);
        }

        // Create channel card HTML
        function createChannelCard(channel) {
            const isJoined = joinedChannels.has(channel.id);
            const buttonText = isJoined ? 'Joined' : 'Join';
            const buttonClass = isJoined ? 'joined' : '';
            return `
                <div class="channel-card animate-fade-in-up" data-animate>
                    <div class="channel-header">
                        <div class="channel-icon">${channel.icon}</div>
                        <div class="channel-info">
                            <h3>${channel.name}</h3>
                            <div class="members">${channel.members} members</div>
                        </div>
                    </div>
                    <div class="channel-description">${channel.description}</div>
                    <div class="channel-tags">
                        ${channel.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <button class="join-btn ${buttonClass}" onclick="joinChannel('${channel.id}', '${channel.link}', this)" ${isJoined ? 'disabled' : ''} data-animate>
                        <i class="fas ${isJoined ? 'fa-check' : 'fa-plus'}"></i>
                        ${buttonText}
                    </button>
                </div>
            `;
        }

        // Join channel function
        function joinChannel(channelId, link, buttonElement) {
            if (joinedChannels.has(channelId)) {
                showStatusMessage('You have already joined this channel!', 'warning');
                return;
            }
            // Add ripple effect
            triggerButtonRipple(buttonElement, event);
            // Update button state
            buttonElement.classList.add('joining', 'animate-pulse');
            buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Joining...';
            buttonElement.disabled = true;
            // Simulate API call
            setTimeout(() => {
                // Open the channel link
                window.open(link, '_blank');
                // Update local state
                joinedChannels.add(channelId);
                saveJoinedChannels();
                // Update button
                buttonElement.classList.remove('joining', 'animate-pulse');
                buttonElement.classList.add('joined');
                buttonElement.innerHTML = '<i class="fas fa-check"></i> Joined';
                showStatusMessage('Successfully joined the channel! Check your new tab.', 'success');
                // Confetti effect
                launchConfetti();
                // Send join event to backend
                sendJoinEvent(channelId, link, currentPlatform);
                // Notify parent window if opened from main site
                if (window.opener) {
                    const channelData = platformData[currentPlatform].find(ch => ch.id === channelId);
                    window.opener.postMessage({
                        type: 'channel-joined',
                        channelId: channelId,
                        channelName: channelData ? channelData.name : 'Unknown Channel',
                        platform: currentPlatform
                    }, '*');
                }
            }, 1500);
        }

        // Join custom channel
        function joinCustomChannel(event) {
            if (event) event.preventDefault();
            const nameInput = document.getElementById('custom-name');
            const descInput = document.getElementById('custom-description');
            const tagsInput = document.getElementById('custom-tags');
            const linkInput = document.getElementById('custom-link');
            const name = nameInput.value.trim();
            const description = descInput.value.trim();
            const tags = tagsInput.value.split(',').map(t => t.trim()).filter(Boolean);
            const link = linkInput.value.trim();

            if (!name) {
                showStatusMessage('Please enter a channel/server name.', 'error');
                nameInput.focus();
                return;
            }
            if (!link) {
                showStatusMessage('Please enter a valid channel/server link.', 'error');
                linkInput.focus();
                return;
            }
            if (!isValidChannelLink(link)) {
                showStatusMessage('Invalid link format. Please check the link and try again.', 'error');
                linkInput.focus();
                return;
            }

            // Open link and show success message
            window.open(link, '_blank');
            nameInput.value = '';
            descInput.value = '';
            tagsInput.value = '';
            linkInput.value = '';
            showStatusMessage('Opening channel/server link in new tab!', 'success');

            // Send custom join event (with extra fields)
            sendJoinEvent('custom', link, 'custom', { name, description, tags });

            // Notify parent window if opened from main site
            if (window.opener) {
                window.opener.postMessage({
                    type: 'channel-joined',
                    channelId: 'custom',
                    channelName: name || 'Custom Channel',
                    platform: 'custom',
                    description,
                    tags
                }, '*');
            }
        }

        // Validate channel link
        function isValidChannelLink(link) {
            const patterns = [
                /^https:\/\/t\.me\/\w+/, // Telegram
                /^https:\/\/discord\.gg\/\w+/, // Discord
                /^https:\/\/chat\.whatsapp\.com\/\w+/, // WhatsApp
                /^https:\/\/discord\.com\/invite\/\w+/ // Discord alternative
            ];

            return patterns.some(pattern => pattern.test(link));
        }

        // Show status message
        function showStatusMessage(message, type) {
            const statusElement = document.getElementById('status-message');
            statusElement.className = `status-message ${type}`;
            statusElement.textContent = message;
            statusElement.style.display = 'block';

            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }

        // Backend URL configuration
        function getBackendUrl(path) {
            // Change this port if your backend runs on a different port
            const backendPort = 5000;
            // Use the same host as the frontend to avoid CORS issues
            const backendHost = window.location.hostname === 'localhost' ? 'localhost' : '127.0.0.1';
            return `http://${backendHost}:${backendPort}${path}`;
        }

        // Send join event to backend
        function sendJoinEvent(channelId, link, platform, extra = {}) {
            fetch(getBackendUrl('/api/join-channel'), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
                body: JSON.stringify({
                    channelId: channelId,
                    link: link,
                    platform: platform,
                    timestamp: new Date().toISOString(),
                    ...extra
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Join event sent successfully:', data);
            })
            .catch(error => {
                console.error('Error sending join event:', error);
            });
        }

        // Save joined channels to localStorage
        function saveJoinedChannels() {
            localStorage.setItem('joinedChannels', JSON.stringify(Array.from(joinedChannels)));
        }

        // Load joined channels from localStorage
        function loadJoinedChannels() {
            const saved = localStorage.getItem('joinedChannels');
            if (saved) {
                joinedChannels = new Set(JSON.parse(saved));
            }
        }

        // Mobile menu toggle
        function toggleMenu() {
            const navMenu = document.querySelector('.nav-menu');
            navMenu.classList.toggle('active');
        }

        // Load footer stats
        async function loadFooterStats() {
            try {
                const response = await fetch(getBackendUrl('/api/channel-stats'));
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const statsElement = document.getElementById('footer-stats');
                        statsElement.innerHTML = `
                            ${data.stats.totalJoins} Total Joins • 
                            ${data.stats.totalChannels} Active Channels • 
                            ${Object.keys(data.stats.platformStats).length} Platforms
                        `;
                    }
                }
            } catch (error) {
                console.log('Could not load footer stats:', error);
            }
        }

        // Button ripple effect (copied from animations.js for standalone use)
        function triggerButtonRipple(button, event) {
            if (!event) return;
            const rect = button.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            ripple.style.left = `${x}px`;
            ripple.style.top = `${y}px`;
            button.appendChild(ripple);
            setTimeout(() => { ripple.remove(); }, 1000);
        }
        // Confetti effect
        function launchConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.display = 'block';
            const ctx = canvas.getContext('2d');
            const confettiCount = 120;
            const confetti = [];
            for (let i = 0; i < confettiCount; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * -canvas.height,
                    r: Math.random() * 6 + 4,
                    d: Math.random() * confettiCount,
                    color: `hsl(${Math.random()*360}, 70%, 60%)`,
                    tilt: Math.random() * 10 - 10
                });
            }
            let angle = 0;
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                angle += 0.01;
                for (let i = 0; i < confettiCount; i++) {
                    let c = confetti[i];
                    ctx.beginPath();
                    ctx.arc(c.x, c.y, c.r, 0, 2 * Math.PI);
                    ctx.fillStyle = c.color;
                    ctx.fill();
                    c.y += Math.cos(angle + c.d) + 2 + c.r/2;
                    c.x += Math.sin(angle) * 2;
                    if (c.y > canvas.height) {
                        c.x = Math.random() * canvas.width;
                        c.y = Math.random() * -20;
                    }
                }
            }
            let frame = 0;
            function animate() {
                draw();
                frame++;
                if (frame < 80) {
                    requestAnimationFrame(animate);
                } else {
                    canvas.style.display = 'none';
                }
            }
            animate();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                window.history.back();
            }
        });
    </script>

    <footer>
        <div class="footer-content footer-headings-horizontal">
            <div class="footer-heading-row">
                <div class="footer-heading">🎨 Emoji Paradise</div>
                <div class="footer-heading">Quick Links</div>
                <div class="footer-heading">Join Communities</div>
            </div>
            <div class="footer-sections-vertical">
                <div class="footer-section">
                    <p>Your ultimate destination for emojis, GIFs, and creative content!</p>
                    <div class="footer-links">
                        <a href="index.html">Home</a>
                        <a href="test-join-channels.html" target="_blank">API Test</a>
                    </div>
                </div>
                <div class="footer-section">
                    <div class="footer-links">
                        <a href="index.html#emojis">Emoji Collection</a>
                        <a href="index.html#gifs">GIF Collection</a>
                        <a href="index.html#customize">Create Custom</a>
                        <a href="index.html#downloads">Downloads</a>
                    </div>
                </div>
                <div class="footer-section footer-section-horizontal">
                    <div class="footer-horizontal-links footer-vertical-links">
                        <a href="#" onclick="showPlatform('telegram')" class="platform-link">
                            <i class="fab fa-telegram"></i> Telegram
                        </a>
                        <a href="#" onclick="showPlatform('discord')" class="platform-link">
                            <i class="fab fa-discord"></i> Discord
                        </a>
                        <a href="#" onclick="showPlatform('whatsapp')" class="platform-link">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="footer-stats" id="footer-stats">
                <!-- Stats will be loaded here -->
            </div>
        </div>
    </footer>
    <script src="animations.js"></script>
    <style>
    /* Make join communities links vertical in the footer */
    .footer-vertical-links {
        display: flex !important;
        flex-direction: column !important;
        gap: 16px !important;
        align-items: flex-start !important;
        justify-content: flex-start !important;
    }
    .footer-vertical-links .platform-link {
        width: 180px;
        justify-content: flex-start;
        font-size: 1.08rem;
        font-weight: 500;
        background: rgba(76, 81, 162, 0.18);
        padding: 10px 18px;
        border-radius: 8px;
        margin: 0;
        transition: background 0.2s, color 0.2s;
        text-decoration: none;
    }
    .footer-vertical-links .platform-link:hover {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        text-decoration: none;
    }
    @media (max-width: 900px) {
        .footer-vertical-links {
            width: 100%;
            align-items: stretch !important;
        }
        .footer-vertical-links .platform-link {
            width: 100%;
        }
    }
    </style>
    <div class="copyright-footer">
        &copy; 2025 Emoji Paradise. Thanks for joining our community!
    </div>
</body>
</html>
